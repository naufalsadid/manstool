<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Tools Content (Fixed)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <style>
        /* General Styles */
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #d1d5db; }
        .aspect-9-16 { aspect-ratio: 9 / 16; }
        .aspect-square-custom { aspect-ratio: 1 / 1; }
        .aspect-video { aspect-ratio: 16 / 9; }
        .card { background-color: #1f2937; border: 1px solid #374151; border-radius: 0.75rem; }
        .tab-btn { background-color: transparent; color: #9ca3af; border-bottom: 2px solid transparent; transition: color 0.3s, border-color 0.3s; }
        .tab-btn.active { color: #06b6d4; border-color: #06b6d4; }
        .btn-primary { background-color: #06b6d4; color: white; transition: background-color 0.3s; }
        .btn-primary:hover { background-color: #0891b2; }
        .btn-primary:disabled { background-color: #374151; color: #6b7280; cursor: not-allowed; }
        .btn-secondary { background-color: #374151; color: #e5e7eb; transition: background-color 0.3s; }
        .btn-secondary:hover { background-color: #4b5563; }
        .btn-secondary:disabled { background-color: #1f2937; color: #4b5563; cursor: not-allowed; }
        .loader { border: 3px solid rgba(6, 182, 212, 0.5); border-left-color: #374151; width: 24px; height: 24px; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .file-input-label { cursor: pointer; border: 2px dashed #4b5563; padding: 1.5rem; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: border-color 0.3s, background-color 0.3s; }
        .file-input-label:hover { border-color: #9ca3af; background-color: #374151; }
        .result-card { transition: transform 0.3s, box-shadow 0.3s; }
        .result-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 50; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-backdrop.visible { opacity: 1; pointer-events: auto; }
        .modal-content { background-color: #1f2937; padding: 2rem; border-radius: 0.75rem; width: 90%; max-width: 500px; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-backdrop.visible .modal-content { transform: scale(1); }
        /* UGC Styles */
        .ugc-output-box { @apply p-4 rounded-xl border border-slate-700 bg-slate-900 overflow-x-auto whitespace-pre-wrap text-sm; min-height: 250px; }
        .ugc-input, .ugc-dropdown { @apply focus:outline-none focus:ring-2 focus:ring-indigo-500/70 focus:border-indigo-500/70; }
    </style>
</head>
<body class="text-gray-200 bg-slate-950">

    <div class="relative w-full max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-6">
            <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-600">
                Magic Tools Content
            </h1>
            <p class="text-lg text-gray-400 mt-2">Solusi Konten AI (Versi Perbaikan)</p>
        </header>

        <nav class="flex flex-col items-center border-b-2 border-gray-700 mb-8">
            <div class="flex justify-center flex-wrap w-full mb-2 gap-2">
                <button id="tab-broll" class="tab-btn px-4 py-2 font-semibold active">‚ú® Foto Produk</button>
                <button id="tab-caption" class="tab-btn px-4 py-2 font-semibold">‚úçÔ∏è Caption SEO</button>
                <button id="tab-ugc" class="tab-btn px-4 py-2 font-semibold">üí¨ UGC Prompt</button>
                <button id="tab-story" class="tab-btn px-4 py-2 font-semibold">üìñ Story Line AI</button>
                <button id="tab-voiceover" class="tab-btn px-4 py-2 font-semibold">üé§ Voice Over</button>
            </div>
        </nav>

        <div id="content-broll" class="tab-content">
            <main class="flex flex-col lg:flex-row gap-8">
                <div class="card p-6 w-full lg:w-1/3 flex-shrink-0 self-start">
                    <h2 class="text-xl font-semibold mb-3">1. Unggah Produk</h2>
                    <input type="file" id="broll-image-input" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-600 file:text-white hover:file:bg-cyan-700" accept="image/*">
                    
                    <h2 class="text-xl font-semibold mt-4 mb-3">2. Prompt Tambahan</h2>
                    <textarea id="broll-product-desc-input" rows="3" class="w-full p-3 bg-gray-900 border border-gray-600 rounded-lg text-gray-200" placeholder="Deskripsi tambahan..."></textarea>
                    
                    <button id="broll-generate-desc-btn" class="mt-4 w-full btn-secondary py-2 rounded-lg">üîç Analisis Deskripsi Produk</button>
                </div>
                <div class="flex-grow">
                    <div id="broll-result-area" class="p-4 bg-gray-800 rounded-lg min-h-[200px] whitespace-pre-wrap">Hasil analisis akan muncul di sini...</div>
                </div>
            </main>
        </div>

        <div id="content-caption" class="tab-content hidden">
            <div class="max-w-2xl mx-auto card p-6">
                <h2 class="text-xl font-semibold mb-3">Generator Caption SEO</h2>
                <textarea id="caption-topic-input" rows="4" class="w-full p-3 bg-gray-900 border border-gray-600 rounded-lg mb-4" placeholder="Topik atau Produk..."></textarea>
                <button id="caption-generate-btn" class="w-full btn-primary py-3 rounded-lg">Buat Caption</button>
                <div id="caption-result-container" class="mt-6 hidden">
                    <div id="caption-text-area" class="bg-gray-900 p-4 rounded-lg whitespace-pre-wrap"></div>
                </div>
            </div>
        </div>

        <div id="content-voiceover" class="tab-content hidden">
            <div class="max-w-2xl mx-auto card p-6">
                <h2 class="text-xl font-semibold mb-3">Generator Naskah Voice Over</h2>
                <p class="text-sm text-gray-400 mb-4">Catatan: Fitur ini membuat Naskah. Untuk audio, gunakan alat TTS eksternal.</p>
                <input type="text" id="vo-script-topic" class="w-full p-3 bg-gray-900 border border-gray-600 rounded-lg mb-4" placeholder="Topik Script...">
                <button id="vo-generate-script-btn" class="w-full btn-primary py-3 rounded-lg">Buat Naskah</button>
                <textarea id="vo-text-input" rows="6" class="w-full mt-4 p-3 bg-gray-900 border border-gray-600 rounded-lg"></textarea>
            </div>
        </div>

        <div id="content-ugc" class="tab-content hidden"><div id="react-ugc-root"></div></div>
        <div id="content-story" class="tab-content hidden"><div id="react-story-root"></div></div>

        <div id="universal-modal" class="modal-backdrop">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modal-title" class="text-xl font-bold"></h3>
                    <button id="close-modal-btn" class="text-gray-500 hover:text-white text-2xl">&times;</button>
                </div>
                <div id="modal-body"></div>
            </div>
        </div>

    </div>

    <script type="text/babel">
        // --- KONFIGURASI API KEY (Paste di sini) ---
        // Ganti dengan API Key Anda yang benar
        const GLOBAL_API_KEY = "AIzaSyB1npkhRfQIPl4iZkQU_ncTaXBDo0lWf6A"; 
        const GEMINI_MODEL = "gemini-1.5-flash"; // Model yang valid dan gratis

        // --- HELPER FUNCTION UNTUK API ---
        async function callGeminiAPI(prompt, imageBase64 = null) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GLOBAL_API_KEY}`;
            
            const parts = [{ text: prompt }];
            if (imageBase64) {
                parts.push({
                    inlineData: {
                        mimeType: "image/jpeg",
                        data: imageBase64
                    }
                });
            }

            const payload = { contents: [{ parts: parts }] };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error(error);
                alert("Gagal menghubungi Gemini: " + error.message);
                return null;
            }
        }

        // --- REACT COMPONENTS (Simplified for fix) ---
        const { useState } = React;
        const { createRoot } = ReactDOM;

        // UGC Generator Component
        const UGCGenerator = () => {
            const [input, setInput] = useState("");
            const [output, setOutput] = useState("");
            const [loading, setLoading] = useState(false);

            const handleGenerate = async () => {
                if(!input) return alert("Isi topik dulu");
                setLoading(true);
                const prompt = `Buatkan prompt UGC video concept yang detail untuk topik: ${input}. Berikan visual direction, hook, dan script.`;
                const result = await callGeminiAPI(prompt);
                setOutput(result || "Gagal");
                setLoading(false);
            };

            return (
                <div className="card p-6 max-w-2xl mx-auto">
                    <h2 className="text-xl font-bold mb-4">UGC Prompt Generator</h2>
                    <input className="w-full p-3 bg-gray-900 rounded mb-4 border border-gray-600" 
                           placeholder="Produk/Topik..." value={input} onChange={e=>setInput(e.target.value)} />
                    <button onClick={handleGenerate} disabled={loading} className="btn-primary w-full py-3 rounded">
                        {loading ? "Memproses..." : "Generate UGC Prompt"}
                    </button>
                    {output && <div className="mt-4 p-4 bg-gray-900 rounded whitespace-pre-wrap">{output}</div>}
                </div>
            );
        };

        // Story Generator Component
        const StoryGenerator = () => {
            const [topic, setTopic] = useState("");
            const [story, setStory] = useState("");
            const [loading, setLoading] = useState(false);

            const handleGenerate = async () => {
                if(!topic) return alert("Isi topik dulu");
                setLoading(true);
                const prompt = `Buatkan storyboard video pendek 60 detik untuk: ${topic}. Bagi menjadi 5 scene dengan deskripsi visual dan audio.`;
                const result = await callGeminiAPI(prompt);
                setStory(result || "Gagal");
                setLoading(false);
            };

            return (
                <div className="card p-6 max-w-2xl mx-auto">
                    <h2 className="text-xl font-bold mb-4">Story Line AI</h2>
                    <input className="w-full p-3 bg-gray-900 rounded mb-4 border border-gray-600" 
                           placeholder="Ide Cerita..." value={topic} onChange={e=>setTopic(e.target.value)} />
                    <button onClick={handleGenerate} disabled={loading} className="btn-primary w-full py-3 rounded">
                        {loading ? "Memproses..." : "Buat Storyboard"}
                    </button>
                    {story && <div className="mt-4 p-4 bg-gray-900 rounded whitespace-pre-wrap">{story}</div>}
                </div>
            );
        };

        // Render React
        const ugcRoot = createRoot(document.getElementById('react-ugc-root'));
        ugcRoot.render(<UGCGenerator />);
        
        const storyRoot = createRoot(document.getElementById('react-story-root'));
        storyRoot.render(<StoryGenerator />);

        // --- VANILLA JS LOGIC ---
        
        // Tab Switching
        const tabs = ['broll', 'caption', 'ugc', 'story', 'voiceover'];
        tabs.forEach(t => {
            document.getElementById(`tab-${t}`).addEventListener('click', () => {
                tabs.forEach(x => {
                    document.getElementById(`content-${x}`).classList.add('hidden');
                    document.getElementById(`tab-${x}`).classList.remove('active');
                });
                document.getElementById(`content-${t}`).classList.remove('hidden');
                document.getElementById(`tab-${t}`).classList.add('active');
            });
        });

        // B-Roll / Image Analysis Logic
        let brollBase64 = null;
        document.getElementById('broll-image-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if(file){
                const reader = new FileReader();
                reader.onload = (ev) => brollBase64 = ev.target.result.split(',')[1];
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('broll-generate-desc-btn').addEventListener('click', async () => {
            if(!brollBase64) return alert("Upload gambar dulu!");
            const btn = document.getElementById('broll-generate-desc-btn');
            btn.innerText = "Menganalisis...";
            const prompt = "Analisis gambar ini dan berikan deskripsi produk yang detail serta ide angle foto yang menarik.";
            const res = await callGeminiAPI(prompt, brollBase64);
            document.getElementById('broll-result-area').innerText = res || "Gagal";
            btn.innerText = "üîç Analisis Deskripsi Produk";
        });

        // Caption Logic
        document.getElementById('caption-generate-btn').addEventListener('click', async () => {
            const topic = document.getElementById('caption-topic-input').value;
            if(!topic) return alert("Isi topik dulu");
            const btn = document.getElementById('caption-generate-btn');
            btn.innerText = "Memproses...";
            const prompt = `Buatkan caption Instagram yang menarik, lucu, dan viral untuk topik: ${topic}. Sertakan 5 hashtag relevan.`;
            const res = await callGeminiAPI(prompt);
            const container = document.getElementById('caption-result-container');
            container.classList.remove('hidden');
            document.getElementById('caption-text-area').innerText = res;
            btn.innerText = "Buat Caption";
        });

        // Voice Over Script Logic
        document.getElementById('vo-generate-script-btn').addEventListener('click', async () => {
            const topic = document.getElementById('vo-script-topic').value;
            if(!topic) return alert("Isi topik dulu");
            const res = await callGeminiAPI(`Buatkan naskah voice over pendek (30 detik) yang engaging tentang: ${topic}. Langsung ke inti naskah.`);
            document.getElementById('vo-text-input').value = res;
        });

        // Modal Logic
        const modal = document.getElementById('universal-modal');
        document.getElementById('close-modal-btn').onclick = () => modal.classList.remove('visible');
        window.onclick = (e) => { if(e.target == modal) modal.classList.remove('visible'); }

    </script>
</body>
</html>